<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í´ë˜ìŠ¤ì–´ë¼ìš´ë“œ Â· ìš´ì˜ ëŒ€ì‹œë³´ë“œ</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- Google API (Sheets/Drive) -->
  <script src="https://apis.google.com/js/api.js" async defer></script>

  <style>
    :root{
      --blue:#2563eb;
      --blue-soft:#eff6ff;
      --red:#ef4444;
      --bg:#f8fafc;
    }
    body{
      margin:0;
      background:var(--bg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:#0f172a;
    }
    .card{
      border-radius:16px;
      border:1px solid #e5e7eb;
      background:#fff;
      box-shadow:0 10px 30px rgba(15,23,42,.06);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:0.35rem;
      font-size:0.75rem;
      padding:0.2rem 0.6rem;
      border-radius:999px;
      border:1px solid rgba(37,99,235,.18);
      background:var(--blue-soft);
      color:#1d4ed8;
    }
    .hidden{display:none!important;}
    .toast{
      position:fixed;
      right:14px;
      bottom:14px;
      padding:8px 12px;
      border-radius:999px;
      background:#0f172a;
      color:#fff;
      opacity:0;
      box-shadow:0 6px 20px rgba(15,23,42,.35);
      z-index:1000;
      font-size:12px;
      transform:translateY(8px);
      pointer-events:none;
      transition:.22s;
    }
    .toast.show{
      opacity:.97;
      transform:translateY(0);
      pointer-events:auto;
    }
  </style>
</head>
<body class="text-slate-900">
  <div class="min-h-screen max-w-6xl mx-auto px-4 py-6 md:py-8">
    <!-- ğŸ”µ ê³µí†µ í—¤ë” (SVG ë¡œê³  ë²„ì „) -->
    <header class="flex items-center justify-between gap-4 mb-6">
      <div class="flex items-center gap-3">
        <!-- ClassAround SVG ë¡œê³  -->
        <div class="h-14 flex items-center">
          <svg class="w-24 h-12" viewBox="0 0 90 50" role="img" aria-label="ClassAround">
            <rect width="90" height="50" rx="10" fill="white"/>
            <circle cx="66" cy="10" r="8" fill="#6b8bd6"/>
            <circle cx="80" cy="18" r="5" fill="#ef4444"/>
            <text x="8" y="24"
                  style="font-family:'Nunito','Arial Rounded MT','SF Pro Rounded','Quicksand','Pretendard','Noto Sans KR',sans-serif;
                         font-weight:900; letter-spacing:-0.2px; fill:#0f172a; font-size:18px;
                         paint-order:stroke fill; stroke:#0f172a; stroke-width:.9px;">
              Class
            </text>
            <text x="8" y="42"
                  style="font-family:'Nunito','Arial Rounded MT','SF Pro Rounded','Quicksand','Pretendard','Noto Sans KR',sans-serif;
                         font-weight:900; letter-spacing:-0.2px; fill:#0f172a; font-size:18px;
                         paint-order:stroke fill; stroke:#0f172a; stroke-width:.9px;">
              Around
            </text>
          </svg>
        </div>

        <div>
          <h1 class="text-xl md:text-2xl font-bold">í´ë˜ìŠ¤ì–´ë¼ìš´ë“œ ìš´ì˜ ëŒ€ì‹œë³´ë“œ</h1>
          <p class="text-xs md:text-sm text-slate-500 mt-1">
            ì¹´ì¹´ì˜¤í†¡ ì…ì¥ì ì²´í¬ Â· ìˆ˜ê°•ìƒ ì‹œíŠ¸ ì—…ë°ì´íŠ¸ Â· ë“œë¼ì´ë¸Œ ìë£Œ ëª¨ìŒ
          </p>
        </div>
      </div>

      <!-- ë¡œê·¸ì¸ ìƒíƒœ + ìƒë‹¨ íƒ­ -->
      <div class="flex flex-col items-end gap-1">
        <div id="authState" class="text-xs md:text-sm text-slate-500">
          Google ë¡œê·¸ì¸ í•„ìš”
        </div>
        <nav class="flex gap-1 text-[11px]">
          <button data-nav="menu"
                  class="px-2.5 py-1 rounded-full border border-slate-200 bg-white hover:bg-slate-50">
            ë©”ì¸
          </button>
          <button data-nav="kakao"
                  class="px-2.5 py-1 rounded-full border border-slate-200 bg-white hover:bg-slate-50">
            ì¹´í†¡
          </button>
          <button data-nav="sync"
                  class="px-2.5 py-1 rounded-full border border-slate-200 bg-white hover:bg-slate-50">
            ì‹œíŠ¸
          </button>
          <button data-nav="drive"
                  class="px-2.5 py-1 rounded-full border border-slate-200 bg-white hover:bg-slate-50">
            ë“œë¼ì´ë¸Œ
          </button>
        </nav>
      </div>
    </header>

    <!-- 1) ë¡œê·¸ì¸ í™”ë©´ -->
    <section id="screen-login" class="card max-w-md mx-auto mt-10">
      <div class="p-5 md:p-6 text-center space-y-3">
        <h2 class="text-base md:text-lg font-semibold">Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</h2>
        <p class="text-xs md:text-sm text-slate-500">
          ìŠ¤í”„ë ˆë“œì‹œíŠ¸ / ë“œë¼ì´ë¸Œ ê¶Œí•œì„ í•œ ë²ˆ í—ˆìš©í•˜ë©´<br/>
          ì•„ë˜ì˜ ìš´ì˜ ë„êµ¬ë“¤ì„ í•œ í™”ë©´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <button id="loginBtn"
                type="button"
                class="inline-flex items-center justify-center px-4 py-2.5 rounded-full text-sm md:text-base font-semibold bg-blue-600 text-white hover:bg-blue-700">
          Google ë¡œê·¸ì¸
        </button>
        <p class="text-[11px] text-slate-400 mt-2">
          í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œì—ëŠ” ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
        </p>
      </div>
    </section>

    <!-- 2) ë©”ì¸ ë©”ë‰´ (ë¡œê·¸ì¸ í›„) -->
    <section id="screen-menu" class="hidden">
      <section class="mb-6 mt-2">
        <span class="pill">
          <span class="w-2 h-2 rounded-full bg-green-500"></span>
          <span>ë¡œê·¸ì¸ ì™„ë£Œ Â· ì‚¬ìš©í•  ê¸°ëŠ¥ì„ ì„ íƒí•˜ì„¸ìš”</span>
        </span>
        <p class="mt-2 text-xs md:text-sm text-slate-500">
          ì¹´ì¹´ì˜¤í†¡ ì…ì¥ì ì²´í¬, ìˆ˜ê°•ìƒ ì‹œíŠ¸ ìë™ ì—…ë°ì´íŠ¸, ë“œë¼ì´ë¸Œ ìë£Œ ëª¨ìŒì„<br/>
          í•œ í˜ì´ì§€ì—ì„œ ì´ë™í•˜ë©´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
      </section>

      <section class="grid md:grid-cols-3 gap-4 md:gap-5">
        <!-- ì¹´ì¹´ì˜¤ -->
        <article class="card p-4 flex flex-col justify-between">
          <div>
            <h2 class="text-base md:text-lg font-semibold mb-1 flex items-center gap-2">
              <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-blue-50 text-blue-600 text-xs font-bold">1</span>
              ì¹´ì¹´ì˜¤í†¡ ì…ì¥ì ì²´í¬ë´‡
            </h2>
            <p class="text-xs md:text-sm text-slate-500 mb-3">
              ì¹´í†¡ë°© ì±„íŒ… ë¡œê·¸(txt / csv)ë¥¼ ë¶ˆëŸ¬ì™€ì„œ<br/>
              ê³µìœ ìš© ì‹œíŠ¸ ê¸°ì¤€ìœ¼ë¡œ <b class="text-blue-600">ì…ì¥ Â· í‡´ì¥</b> ìƒíƒœë¥¼ ìë™ ê¸°ë¡.
            </p>
          </div>
          <div class="mt-4 flex justify-between items-center">
            <span class="text-[11px] text-slate-400">ì¹´ì¹´ì˜¤í†¡ ì…ì¥ì ì²´í¬</span>
            <button data-go="kakao"
                    class="inline-flex items-center justify-center px-3 py-2 rounded-full text-xs md:text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700">
              ì…ì¥ì ì²´í¬ í™”ë©´ ì—´ê¸°
            </button>
          </div>
        </article>

        <!-- ì‹œíŠ¸ -->
        <article class="card p-4 flex flex-col justify-between">
          <div>
            <h2 class="text-base md:text-lg font-semibold mb-1 flex items-center gap-2">
              <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-red-50 text-red-500 text-xs font-bold">2</span>
              ìˆ˜ê°•ìƒ ì‹œíŠ¸ ìë™ ì—…ë°ì´íŠ¸
            </h2>
            <p class="text-xs md:text-sm text-slate-500 mb-3">
              ì¹´ë“œ / ê³„ì¢Œ CSVë¥¼ ì—…ë¡œë“œí•˜ë©´<br/>
              ê²°ì œ ë‚´ì—­ì„ <b class="text-red-500">B2~N</b> êµ¬ê°„ì— ìë™ ì •ë¦¬ ë° ë®ì–´ì“°ê¸°.
            </p>
          </div>
          <div class="mt-4 flex justify-between items-center">
            <span class="text-[11px] text-slate-400">ê²°ì œ ë‚´ì—­ â†’ ìˆ˜ê°•ìƒ ì‹œíŠ¸</span>
            <button data-go="sync"
                    class="inline-flex items-center justify-center px-3 py-2 rounded-full text-xs md:text-sm font-semibold bg-red-500 text-white hover:bg-red-600">
              ì‹œíŠ¸ ì—…ë°ì´íŠ¸ í™”ë©´ ì—´ê¸°
            </button>
          </div>
        </article>

        <!-- ë“œë¼ì´ë¸Œ -->
        <article class="card p-4 flex flex-col justify-between">
          <div>
            <h2 class="text-base md:text-lg font-semibold mb-1 flex items-center gap-2">
              <span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-blue-50 text-blue-600 text-xs font-bold">3</span>
              ë“œë¼ì´ë¸Œ ìë£Œ ëª¨ìŒ
            </h2>
            <p class="text-xs md:text-sm text-slate-500 mb-3">
              í˜„ê¸ˆê²°ì œ í¼, ê°•ì‚¬ ê³µìœ ìš© ì‹œíŠ¸, ë¬´ë£Œê°•ì˜ ìë£Œ ë“±<br/>
              ìì£¼ ì“°ëŠ” êµ¬ê¸€ ë“œë¼ì´ë¸Œ í´ë”ë¥¼ í•œ ë²ˆì— ëª¨ì•„ì„œ í™•ì¸.
            </p>
          </div>
          <div class="mt-4 flex justify-between items-center">
            <span class="text-[11px] text-slate-400">Drive í´ë” ë·°ì–´</span>
            <button data-go="drive"
                    class="inline-flex items-center justify-center px-3 py-2 rounded-full text-xs md:text-sm font-semibold bg-sky-500 text-white hover:bg-sky-600">
              ë“œë¼ì´ë¸Œ í™”ë©´ ì—´ê¸°
            </button>
          </div>
        </article>
      </section>

      <footer class="mt-8 text-[11px] text-slate-400 text-right">
        Â© ClassAround Internal Tools (One Page)
      </footer>
    </section>

    <!-- 3) ì¹´ì¹´ì˜¤ í™”ë©´ -->
    <section id="screen-kakao" class="hidden mt-2">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-sm md:text-base font-semibold flex items-center gap-2">
          <span class="text-blue-600 text-lg">ğŸ’¬</span> ì¹´ì¹´ì˜¤í†¡ ì…ì¥ì ì²´í¬ë´‡
        </h2>
        <button data-go="menu"
                class="px-2.5 py-1.5 rounded-full border border-slate-200 bg-white text-[11px] hover:bg-slate-50">
          â† ë©”ì¸ìœ¼ë¡œ
        </button>
      </div>

      <!-- âœ… ì—¬ê¸°ì— ê¸°ì¡´ kakao.htmlì˜ ë©”ì¸ UI ë¶™ì´ê¸° -->
      <div class="rounded-xl border border-slate-200 bg-white p-3 text-[13px] text-slate-600">
        TODO: kakao ì…ì¥ì ì²´í¬ UI + ë¡œì§ ë¶™ì´ê¸°
      </div>
    </section>

    <!-- 4) ì‹œíŠ¸(sync) í™”ë©´ -->
    <section id="screen-sync" class="hidden mt-2">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-sm md:text-base font-semibold flex items-center gap-2">
          <span class="text-red-500 text-lg">ğŸ“‘</span> ìˆ˜ê°•ìƒ ì‹œíŠ¸ ìë™ ì—…ë°ì´íŠ¸
        </h2>
        <button data-go="menu"
                class="px-2.5 py-1.5 rounded-full border border-slate-200 bg-white text-[11px] hover:bg-slate-50">
          â† ë©”ì¸ìœ¼ë¡œ
        </button>
      </div>

      <!-- âœ… ì—¬ê¸°ì— ì§€ê¸ˆ ì“°ëŠ” sync.html ë³¸ë¬¸ UIë¥¼ ê·¸ëŒ€ë¡œ ì˜®ê¸°ë©´ ë¨ -->
      <main id="syncMain" class="max-w-5xl mx-auto px-0 py-2 space-y-3">
        <div class="rounded-xl border border-slate-200 bg-white px-3 py-3 text-[13px] text-slate-600">
          TODO: ê¸°ì¡´ sync UI(ì—…ë¡œë“œ/ì‹œíŠ¸ ì„¤ì •/ë¯¸ë¦¬ë³´ê¸°) + ë¡œì§ ë¶™ì´ê¸°
        </div>
      </main>
    </section>

    <!-- 5) ë“œë¼ì´ë¸Œ í™”ë©´ -->
    <section id="screen-drive" class="hidden mt-2">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-sm md:text-base font-semibold flex items-center gap-2">
          <span class="text-sky-500 text-lg">ğŸ“‚</span> ë“œë¼ì´ë¸Œ í´ë” ëª¨ìŒ
        </h2>
        <button data-go="menu"
                class="px-2.5 py-1.5 rounded-full border border-slate-200 bg-white text-[11px] hover:bg-slate-50">
          â† ë©”ì¸ìœ¼ë¡œ
        </button>
      </div>

      <!-- ë“œë¼ì´ë¸Œ í´ë” UI -->
      <section class="grid lg:grid-cols-[260px,minmax(0,1fr)] gap-5">
        <aside class="bg-white rounded-2xl border border-slate-200 p-3 md:p-4 shadow-sm">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-sm font-semibold flex items-center gap-1.5">
              ğŸ”— í´ë” ì„ íƒ
            </h2>
          </div>
          <div id="folderList" class="space-y-1.5 text-xs md:text-sm"></div>
          <div class="mt-4 p-2.5 rounded-xl bg-sky-50 border border-sky-100 text-[11px] leading-relaxed text-sky-800">
            â“˜ ì„ íƒí•œ í´ë”ëŠ” ì˜¤ë¥¸ìª½ì—ì„œ ë°”ë¡œ ë¯¸ë¦¬ë³´ê¸° ë˜ê³ ,<br />
            ìƒˆ íƒ­ì—ì„œ í¬ê²Œ ë³´ê³  ì‹¶ìœ¼ë©´ ìƒë‹¨ <b>ã€Œìƒˆ íƒ­ì—ì„œ ì—´ê¸°ã€</b>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.
          </div>
        </aside>

        <section class="bg-white rounded-2xl border border-slate-200 shadow-sm flex flex-col min-h-[460px]">
          <div class="px-4 py-3 border-b border-slate-100 flex flex-wrap items-center justify-between gap-3">
            <div>
              <div class="text-xs uppercase tracking-wide text-slate-400 font-semibold">
                DRIVE FOLDER VIEW
              </div>
              <div class="flex items-center gap-2 mt-0.5">
                <h2 id="currentFolderName" class="text-sm md:text-base font-semibold">
                  í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”
                </h2>
                <span id="currentFolderBadge"
                      class="hidden md:inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] font-medium border border-slate-200 text-slate-500">
                  -
                </span>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button id="btnOpenNewTab"
                      class="px-3 py-1.5 rounded-full text-[11px] font-semibold border border-blue-500 text-blue-600 bg-blue-50 hover:bg-blue-100 disabled:opacity-40 disabled:cursor-default"
                      disabled>
                ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
              </button>
            </div>
          </div>
          <div class="flex-1 bg-slate-50 rounded-b-2xl overflow-hidden">
            <iframe
              id="driveFrame"
              src=""
              title="Google Drive folder viewer"
              class="w-full h-[420px] md:h-[520px] border-0 bg-slate-50">
            </iframe>
          </div>
        </section>
      </section>
    </section>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const CLIENT_ID = "18228268359-iifm4ck3j9kqj74eh1p90tco1k2mbpi0.apps.googleusercontent.com";

    let accessToken = null;
    let tokenClient = null;
    let gapiReady = false;

    const $  = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));

    function showToast(msg,type="info"){
      const el=$("#toast"); if(!el) return;
      el.textContent = msg;
      if(type==="error") el.style.background="#b91c1c";
      else if(type==="ok") el.style.background="#15803d";
      else el.style.background="#0f172a";
      el.classList.add("show");
      setTimeout(()=> el.classList.remove("show"),2600);
    }

    function setAuthState(text){
      const el=$("#authState");
      if(el) el.textContent=text;
    }

    function showScreen(name){
      const ids=["login","menu","kakao","sync","drive"];
      ids.forEach(id=>{
        const sec=$("#screen-"+id);
        if(!sec) return;
        if(id===name) sec.classList.remove("hidden");
        else sec.classList.add("hidden");
      });
    }

    async function ensureGapi(){
      if(!accessToken) throw new Error("ë¨¼ì € Google ë¡œê·¸ì¸ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.");
      if(gapiReady) return;
      await new Promise(res=>{
        const chk=()=>{ if(window.gapi && gapi.load){res();} else setTimeout(chk,50); };
        chk();
      });
      await new Promise((res,rej)=>{
        gapi.load("client", async ()=>{
          try{
            await gapi.client.load("https://sheets.googleapis.com/$discovery/rest?version=v4");
            gapi.client.setToken({access_token:accessToken});
            gapiReady=true;
            res();
          }catch(e){ rej(e); }
        });
      });
    }

    function initAuthClient(){
      if(!window.google?.accounts?.oauth2){
        setTimeout(initAuthClient,120);
        return;
      }
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: "https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.readonly",
        prompt: "consent", // ì ‘ì†í•  ë•Œë§ˆë‹¤ ì„ íƒ
        callback: (res)=>{
          if(res && res.access_token){
            accessToken = res.access_token;
            setAuthState("ë¡œê·¸ì¸ ì™„ë£Œ Â· ì´ í˜ì´ì§€ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥");
            showToast("Google ë¡œê·¸ì¸ ì„±ê³µ","ok");
            showScreen("menu");
          }else{
            setAuthState("ë¡œê·¸ì¸ ì‹¤íŒ¨ Â· ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”");
            showScreen("login");
          }
        }
      });
    }

    // ===== ë“œë¼ì´ë¸Œ í´ë” =====
    const FOLDERS = [
      {
        id: "1LdDYVwxDrpqpPy2HYlSnrw2w7YKhsKWF",
        name: "í˜„ê¸ˆê²°ì œ êµ¬ê¸€í¼",
        desc: "í˜„ê¸ˆ/ê³„ì¢Œ ê²°ì œ ì‘ë‹µ ëª¨ìŒ",
        originalUrl: "https://drive.google.com/drive/folders/1LdDYVwxDrpqpPy2HYlSnrw2w7YKhsKWF?usp=drive_link"
      },
      {
        id: "1t33dy_UQCfsvoEQ9yOctIxvoT623i-j4",
        name: "ê°•ì‚¬ ê³µìœ ìš© ì‹œíŠ¸",
        desc: "ê°•ì‚¬ì§„ ê³µìœ  ì‹œíŠ¸ & ìë£Œ",
        originalUrl: "https://drive.google.com/drive/folders/1t33dy_UQCfsvoEQ9yOctIxvoT623i-j4?usp=drive_link"
      },
      {
        id: "1C1OsgYqZtxauLNN9l4mRHPgaIavrhmq-",
        name: "ë¬´ë£Œê°•ì˜ ì „ìì±… êµ¬ê¸€í¼",
        desc: "ë¬´ë£Œ ì „ìì±… ì‹ ì²­ ì‘ë‹µ",
        originalUrl: "https://drive.google.com/drive/u/0/folders/1C1OsgYqZtxauLNN9l4mRHPgaIavrhmq-"
      },
      {
        id: "1BU7ugKEeRXmG3PoRGJqKHlxuVtgT2_js",
        name: "ë¬´ë£Œê°•ì˜ ì‚¬ì „ ì§ˆë¬¸",
        desc: "ë¬´ë£Œê°•ì˜ Q&A / ì‚¬ì „ì§ˆë¬¸",
        originalUrl: "https://drive.google.com/drive/folders/1BU7ugKEeRXmG3PoRGJqKHlxuVtgT2_js?usp=drive_link"
      },
      {
        id: "1Ej6eIw0WwCn8NxtwW5A4vj8wo2xyKATC",
        name: "ë¼ì´ë¸Œ ìë£Œ",
        desc: "ë¼ì´ë¸Œ ë°©ì†¡ ìë£ŒÂ·PPT ëª¨ìŒ",
        originalUrl: "https://drive.google.com/drive/folders/1Ej6eIw0WwCn8NxtwW5A4vj8wo2xyKATC?usp=drive_link"
      }
    ];
    function driveEmbedUrl(id){
      return `https://drive.google.com/embeddedfolderview?id=${encodeURIComponent(id)}#list`;
    }
    function initDriveScreen(){
      const folderListEl = $("#folderList");
      const driveFrameEl = $("#driveFrame");
      const currentFolderName = $("#currentFolderName");
      const currentFolderBadge = $("#currentFolderBadge");
      const btnOpenNewTab = $("#btnOpenNewTab");
      if(!folderListEl || !driveFrameEl) return;

      let currentFolderId = null;

      function renderButtons(){
        folderListEl.innerHTML="";
        FOLDERS.forEach(f=>{
          const btn=document.createElement("button");
          btn.type="button";
          btn.dataset.folderId=f.id;
          btn.className="w-full flex items-center justify-between gap-2 px-3 py-2 rounded-xl border border-slate-200 bg-white hover:border-blue-300 hover:bg-slate-50 text-left transition";
          btn.innerHTML=`
            <div class="flex items-center gap-2">
              <div class="dot w-1.5 h-1.5 rounded-full bg-slate-300"></div>
              <div>
                <div class="font-semibold text-xs md:text-[13px] truncate">${f.name}</div>
                <div class="text-[11px] text-slate-500 truncate">${f.desc}</div>
              </div>
            </div>
            <span class="text-[10px] font-semibold px-1.5 py-0.5 rounded-full border border-slate-200 text-slate-500">ì—´ê¸°</span>`;
          btn.addEventListener("click",()=>selectFolder(f.id));
          folderListEl.appendChild(btn);
        });
      }
      function updateActive(){
        folderListEl.querySelectorAll("button[data-folder-id]").forEach(b=>{
          if(b.dataset.folderId===currentFolderId){
            b.classList.add("border-blue-400","bg-blue-50");
          }else{
            b.classList.remove("border-blue-400","bg-blue-50");
          }
        });
      }
      function selectFolder(id){
        const f=FOLDERS.find(x=>x.id===id);
        if(!f) return;
        currentFolderId=id;
        driveFrameEl.src=driveEmbedUrl(f.id);
        currentFolderName.textContent=f.name;
        currentFolderBadge.textContent=f.desc||"";
        currentFolderBadge.classList.remove("hidden");
        btnOpenNewTab.disabled=false;
        btnOpenNewTab.onclick=()=>window.open(f.originalUrl,"_blank","noopener");
        updateActive();
      }

      renderButtons();
      if(FOLDERS.length>0) selectFolder(FOLDERS[0].id);
    }

    let kakaoInited=false;
    let syncInited=false;
    let driveInited=false;

    function initKakaoTool(){
      if(kakaoInited) return;
      kakaoInited=true;
      // ğŸ”µ ì—¬ê¸° ì•ˆì— ê¸°ì¡´ kakao ë¡œì§ ë¶™ì´ê¸° (Google Sheets í•„ìš”í•˜ë©´ ensureGapi() í˜¸ì¶œ í›„ ì‚¬ìš©)
    }

    function initSyncTool(){
      if(syncInited) return;
      syncInited=true;
      // ğŸ”´ ì—¬ê¸° ì•ˆì— ê¸°ì¡´ sync ì½”ë“œì˜ document.addEventListener('DOMContentLoaded', ...) ë¶€ë¶„ ë‚´ìš© ì˜®ê¸°ê¸°
      // ì¸ì¦ ê´€ë ¨ì€ ì§€ìš°ê³ , sheets í˜¸ì¶œ ì „ì—ëŠ” await ensureGapi(); ì‚¬ìš©
    }

    window.addEventListener("load", ()=>{
      initAuthClient();
      showScreen("login");

      const loginBtn=$("#loginBtn");
      if(loginBtn){
        loginBtn.addEventListener("click",()=>{
          if(!tokenClient){
            alert("Google ë¡œê·¸ì¸ ì´ˆê¸°í™” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            return;
          }
          tokenClient.requestAccessToken();
        });
      }

      // ë©”ì¸/ìƒë‹¨ ë„¤ë¹„ìš© ë²„íŠ¼
      $$("[data-go]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const target=btn.getAttribute("data-go");
          if(target==="menu"){
            if(accessToken) showScreen("menu");
            else showScreen("login");
            return;
          }
          if(!accessToken){
            showToast("ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”","error");
            showScreen("login");
            return;
          }
          if(target==="kakao"){
            showScreen("kakao");
            initKakaoTool();
          }else if(target==="sync"){
            try{ await ensureGapi(); }catch(e){ showToast(e.message,"error"); return; }
            showScreen("sync");
            initSyncTool();
          }else if(target==="drive"){
            showScreen("drive");
            if(!driveInited){ initDriveScreen(); driveInited=true; }
          }
        });
      });

      $$("[data-nav]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const dest=btn.getAttribute("data-nav");
          if(dest==="menu"){
            if(accessToken) showScreen("menu"); else showScreen("login");
          }else if(dest==="kakao"){
            if(!accessToken){ showToast("ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”","error"); showScreen("login"); return; }
            showScreen("kakao"); initKakaoTool();
          }else if(dest==="sync"){
            if(!accessToken){ showToast("ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”","error"); showScreen("login"); return; }
            try{ await ensureGapi(); }catch(e){ showToast(e.message,"error"); return; }
            showScreen("sync"); initSyncTool();
          }else if(dest==="drive"){
            if(!accessToken){ showToast("ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”","error"); showScreen("login"); return; }
            showScreen("drive");
            if(!driveInited){ initDriveScreen(); driveInited=true; }
          }
        });
      });
    });

    window.addEventListener("error", e=>{
      showToast("ì˜¤ë¥˜: "+(e?.error?.message||e.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"),"error");
    });
    window.addEventListener("unhandledrejection", e=>{
      showToast("ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì˜¤ë¥˜: "+(e?.reason?.message||e.reason||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"),"error");
    });
  </script>
</body>
</html>
